{% extends 'labtest/base.html' %}

{% block title %}Labtests Details{% endblock %}

{% block style %}
   .table.no-border tr td, .table.no-border tr th {
  border-width: 0;
}

{% endblock %}
{% block body %}

    <script>
        var map;

        function initMap() {

            if (navigator.geolocation)
            {
                try
                {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        var myLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        setPos(myLocation);
                    });
                }

                catch (err)
                {
                    var myLocation = {
                        lat: 13.5232,
                        lng: 79.9982
                    };
                    setPos(myLocation);
                }
            }

            else
            {
                var myLocation = {
                    lat: 13.5232,
                    lng: 79.9982
                };
                setPos(myLocation);
            }

            var querylocation = "{{ query }}" ;
            var geocoder = new google.maps.Geocoder();

            if (geocoder && querylocation) {
                geocoder.geocode({
                    'address': querylocation
                }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        var latitude = results[0].geometry.location.lat();
                        var longitude = results[0].geometry.location.lng();
                        var myLocation = {
                            lat: latitude,
                            lng: longitude
                        };

                         if (querylocation==''|| querylocation=='None'){
                            var myLocation = {
                                lat: 13.5232,
                                lng: 79.9982
                            };
                        }

                        setPos(myLocation);

                    }
                });
            }

        }


        function setPos(myLocation)
        {
            map = new google.maps.Map(document.getElementById('map'), {
                center: myLocation,
                zoom: 10,
            });

            var service = new google.maps.places.PlacesService(map);
            service.nearbySearch({
                location: myLocation,
                radius: 1000000,
                types:['medicallabs'],
                keyword: ['labs']
            }, processResults);

        }


        function processResults(results, status, pagination)
        {
            if (status !== google.maps.places.PlacesServiceStatus.OK) {
                return;
            }
            else
            {
                createMarkers(results);
            }

        }


        function createMarkers(places)
        {
            var bounds = new google.maps.LatLngBounds();
            var placesList = document.getElementById('places');

            for (var i = 0, place; place = places[i]; i++)
            {
                var image = {url: place.icon,
                    size: new google.maps.Size(71, 71),
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(17, 34),
                    scaledSize: new google.maps.Size(25, 25)
                };

                var marker = new google.maps.Marker({
                    map: map,
                    icon: image,
                    title: place.name,
                    animation: google.maps.Animation.DROP,
                    position: place.geometry.location
                });

                bounds.extend(place.geometry.location);
            }

            map.fitBounds(bounds);
        }

    </script>


    <div id="map" style="height: 400px;
    margin: 30px auto;
    width: 600px;
    position:absolute;
    right:50px;"></div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBDDHXhrCzm5a2cemyN2QtIb8B11hvHQE&signed_in=true&libraries=places&callback=initMap" async defer></script>




       {% for test in test %}
           <br><br>
           <div class="row" style="margin: auto">
               <div class="col-sm-5 col-xs-12">
                   <div class="panel ">
                       <div class="panel-body">

                            <table class="table no-border">
                                <tr>
                                    <td>
                                        <img src="https://foodsafetynewsfullservice.marlersites.com/files/2016/04/laboratorytesting-406.jpg" height="100" width="100"/>
                                    </td>
                                    <td>
                                        <p><b>{{ test.test_name }}</b></p>
                                        <p><b>{{ test.cost }}</b></p>
                                        <p><a href="{% url 'labtest:details' pk=test.id%}">View Details</a></p>
                                    </td>
                                    <td>
                                        <button onclick="window.location='{% url 'labtest:labbook' pk=test.id %}'" class="btn btn-primary" >Book Appointment</button>
                                    </td>
                                </tr>
                            </table>
                       </div>

                   </div>
               </div>
           </div>
       {% empty %}
           <h3>Nothing found with name "{{ request.GET.q }}"</h3>
       {% endfor %}


    {% if error_message %}
        <p><strong>{{ error_message }}</strong></p>
    {% endif %}


{% endblock %}